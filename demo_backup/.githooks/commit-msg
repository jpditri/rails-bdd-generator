#!/bin/bash
# Commit message hook to ensure quality commit messages

commit_regex='^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,100}'
error_msg="❌ Invalid commit message format!

Commit message must follow conventional commits format:
<type>(<scope>): <subject>

Types:
- feat: A new feature
- fix: A bug fix
- docs: Documentation changes
- style: Code style changes (formatting, etc)
- refactor: Code refactoring
- test: Adding or updating tests
- chore: Maintenance tasks
- perf: Performance improvements
- ci: CI/CD changes
- build: Build system changes
- revert: Reverting a previous commit

Examples:
- feat(auth): add OAuth2 support
- fix(api): handle null response correctly
- docs(readme): update installation instructions
- test(user): add validation specs

Your message:"

if ! grep -qE "$commit_regex" "$1"; then
  echo "$error_msg"
  cat "$1"
  exit 1
fi

# Check commit message length
subject_line=$(head -n1 "$1")
if [ ${#subject_line} -gt 100 ]; then
  echo "❌ Commit subject line is too long (${#subject_line} > 100 characters)"
  echo "Please keep the first line under 100 characters."
  exit 1
fi

exit 0
